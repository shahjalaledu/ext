<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Articles with TTS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --border: #1f2937;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at 0% 0%, #0ea5e9 0, transparent 40%),
        radial-gradient(circle at 100% 0%, #22c55e 0, transparent 40%),
        radial-gradient(circle at 50% 120%, #6366f1 0, #020617 60%);
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1.6rem 1.5rem 0.8rem;
      text-align: center;
    }

    .title-block {
      display: inline-block;
      padding: 1.2rem 1.8rem;
      border-radius: 1.2rem;
      background: rgba(15, 23, 42, 0.85);
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.4);
      backdrop-filter: blur(14px);
      max-width: 960px;
      text-align: left;
    }

    h1 {
      margin: 0 0 0.35rem;
      font-size: clamp(1.8rem, 3.4vw, 2.3rem);
      letter-spacing: 0.03em;
      color: #f9fafb;
    }

    .subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin-bottom: 0.2rem;
    }

    .note {
      font-size: 0.85rem;
      color: var(--muted);
    }

    main {
      flex: 1;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      padding: 0.4rem 1.5rem 2.2rem;
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 2fr);
      gap: 1rem;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 1.1rem;
      border: 1px solid var(--border);
      padding: 1.1rem 1.2rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
    }

    h2 {
      margin: 0 0 0.6rem;
      font-size: 1.1rem;
    }

    p {
      font-size: 0.94rem;
      color: var(--muted);
      margin: 0.2rem 0 0.7rem;
    }

    /* Article list */
    ul.article-list {
      list-style: none;
      padding: 0;
      margin: 0.4rem 0 0;
    }

    .article-item {
      margin-bottom: 0.35rem;
    }

    .article-link {
      display: block;
      padding: 0.45rem 0.6rem;
      border-radius: 0.5rem;
      text-decoration: none;
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.6);
      font-size: 0.9rem;
      word-break: break-all;
      cursor: pointer;
    }

    .article-link:hover {
      background: radial-gradient(circle at top left, #0f172a, #020617);
      border-color: rgba(56, 189, 248, 0.7);
    }

    .article-link.active {
      border-color: rgba(56, 189, 248, 0.9);
      background: rgba(15, 23, 42, 0.9);
    }

    /* TTS player and article content */
    .article-panel {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .tts-player {
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      padding: 0.8rem 1rem;
      background: #020617;
    }

    .tts-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 0.75rem;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .tts-controls button {
      padding: 0.35rem 0.7rem;
      border-radius: 0.4rem;
      border: 1px solid #4b5563;
      background: #111827;
      cursor: pointer;
      font-size: 0.85rem;
      color: #e5e7eb;
    }

    .tts-controls button:hover {
      background: #1f2937;
    }

    .tts-label {
      font-size: 0.8rem;
      color: var(--muted);
      margin-right: 0.25rem;
    }

    .tts-slider {
      flex: 1;
      min-width: 120px;
    }

    .tts-slider input[type="range"] {
      width: 100%;
    }

    .tts-select {
      min-width: 140px;
      font-size: 0.85rem;
      padding: 0.2rem 0.3rem;
      background: #020617;
      border: 1px solid #4b5563;
      color: #e5e7eb;
      border-radius: 0.4rem;
    }

    .tts-status {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.3rem;
    }

    .article-content {
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      padding: 0.8rem 1rem;
      background: #020617;
      max-height: 60vh;
      overflow: auto;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .article-content h1,
    .article-content h2,
    .article-content h3 {
      margin-top: 0.2rem;
    }

    footer {
      text-align: center;
      padding: 0.9rem 1rem 1.4rem;
      font-size: 0.8rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <div class="title-block">
      <h1>My Articles with TTS</h1>
      <div class="subtitle">
        Single homepage that lists your HTML articles and reads them aloud.
      </div>
      <div class="note">
        Push a new <code>.html</code> file to this repo &mdash; the index and TTS will update automatically.
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: article index -->
    <section class="card">
      <h2>Articles</h2>
      <p>Click an article to load its content and use the TTS player.</p>

      <!-- ARTICLE_INDEX_START -->
      <!-- The generated list of article links will be inserted here. Do not edit manually. -->
      <!-- ARTICLE_INDEX_END -->
    </section>

    <!-- RIGHT: TTS + content -->
    <section class="card article-panel">
      <div class="tts-player" aria-label="Text to Speech Player">
        <div class="tts-row tts-controls">
          <button type="button" id="tts-play">Play</button>
          <button type="button" id="tts-pause">Pause</button>
          <button type="button" id="tts-resume">Resume</button>
          <button type="button" id="tts-stop">Stop</button>
        </div>

        <div class="tts-row">
          <span class="tts-label">Speed:</span>
          <div class="tts-slider">
            <input type="range" id="tts-rate" min="0.5" max="2.0" step="0.1" value="1" />
          </div>
          <span id="tts-rate-value" class="tts-label">1.0x</span>
        </div>

        <div class="tts-row">
          <span class="tts-label">Seek:</span>
          <div class="tts-slider">
            <input type="range" id="tts-seek" min="0" max="100" step="1" value="0" />
          </div>
          <span id="tts-seek-value" class="tts-label">0%</span>
        </div>

        <div class="tts-row">
          <span class="tts-label">Voice:</span>
          <select id="tts-voice" class="tts-select"></select>
        </div>

        <div id="tts-status" class="tts-status">
          Select an article from the left to load its content.
        </div>
      </div>

      <div id="article-content" class="article-content">
        <p>No article loaded yet.</p>
      </div>
    </section>
  </main>

  <footer>
    Auto-generated index + built-in TTS Â· Hosted on GitHub Pages.
  </footer>

  <script>
    (function () {
      if (!("speechSynthesis" in window)) {
        document.getElementById("tts-status").textContent =
          "Your browser does not support speech synthesis.";
        return;
      }

      const synth = window.speechSynthesis;

      const articleListEl = document.querySelector(".article-list");
      const articleContentEl = document.getElementById("article-content");
      const playBtn = document.getElementById("tts-play");
      const pauseBtn = document.getElementById("tts-pause");
      const resumeBtn = document.getElementById("tts-resume");
      const stopBtn = document.getElementById("tts-stop");
      const rateInput = document.getElementById("tts-rate");
      const rateValue = document.getElementById("tts-rate-value");
      const seekInput = document.getElementById("tts-seek");
      const seekValue = document.getElementById("tts-seek-value");
      const voiceSelect = document.getElementById("tts-voice");
      const statusEl = document.getElementById("tts-status");

      let voices = [];
      let currentText = "";
      let currentUtterance = null;
      let currentIndex = 0;
      let currentArticlePath = null;

      function loadVoices() {
        voices = synth.getVoices();
        voiceSelect.innerHTML = "";

        if (!voices.length) {
          const option = document.createElement("option");
          option.value = "";
          option.textContent = "No voices available";
          voiceSelect.appendChild(option);
          return;
        }

        voices.forEach((v, i) => {
          const option = document.createElement("option");
          option.value = i;
          option.textContent = `${v.name} (${v.lang})`;
          voiceSelect.appendChild(option);
        });

        const pageLang = document.documentElement.lang || "en";
        const firstMatch = voices.findIndex(v =>
          v.lang.toLowerCase().startsWith(pageLang.toLowerCase())
        );
        if (firstMatch >= 0) {
          voiceSelect.value = String(firstMatch);
        }
      }

      loadVoices();
      if (typeof speechSynthesis !== "undefined" && speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
      }

      async function loadArticle(path) {
        try {
          statusEl.textContent = "Loading article...";
          const res = await fetch(path, { cache: "no-cache" });
          if (!res.ok) throw new Error("HTTP " + res.status);
          const html = await res.text();

          // Very simple extraction: strip most tags to get text-only for TTS,
          // but render raw HTML inside articleContentEl.
          articleContentEl.innerHTML = html;
          currentText = articleContentEl.textContent.trim();
          currentIndex = 0;
          seekInput.value = 0;
          seekValue.textContent = "0%";
          statusEl.textContent = "Article loaded. Click Play to start reading.";
          currentArticlePath = path;
        } catch (err) {
          console.error("Error loading article:", err);
          articleContentEl.innerHTML = "<p>Error loading article.</p>";
          statusEl.textContent = "Failed to load article.";
        }
      }

      function speakFromCurrentIndex() {
        if (!currentText) {
          statusEl.textContent = "No text to read.";
          return;
        }

        synth.cancel();
        currentUtterance = new SpeechSynthesisUtterance(currentText.slice(currentIndex));

        const selectedVoiceIndex = parseInt(voiceSelect.value, 10);
        if (!isNaN(selectedVoiceIndex) && voices[selectedVoiceIndex]) {
          currentUtterance.voice = voices[selectedVoiceIndex];
        }

        currentUtterance.rate = parseFloat(rateInput.value) || 1.0;

        currentUtterance.onstart = () => {
          statusEl.textContent = "Reading...";
        };
        currentUtterance.onend = () => {
          if (!synth.speaking && !synth.pending) {
            currentIndex = 0;
            seekInput.value = 0;
            seekValue.textContent = "0%";
            statusEl.textContent = "Finished reading.";
          }
        };
        currentUtterance.onerror = (e) => {
          console.error("TTS error:", e);
          statusEl.textContent = "Error during speech synthesis.";
        };

        currentUtterance.onboundary = (event) => {
          if (event.charIndex != null && currentText.length) {
            currentIndex = event.charIndex;
            const percent = Math.round((currentIndex / currentText.length) * 100);
            seekInput.value = percent;
            seekValue.textContent = percent + "%";
          }
        };

        synth.speak(currentUtterance);
      }

      playBtn.addEventListener("click", () => {
        if (!currentText) {
          statusEl.textContent = "Select an article first.";
          return;
        }
        speakFromCurrentIndex();
      });

      pauseBtn.addEventListener("click", () => {
        if (synth.speaking && !synth.paused) {
          synth.pause();
          statusEl.textContent = "Paused.";
        }
      });

      resumeBtn.addEventListener("click", () => {
        if (synth.paused) {
          synth.resume();
          statusEl.textContent = "Resumed reading.";
        }
      });

      stopBtn.addEventListener("click", () => {
        synth.cancel();
        currentIndex = 0;
        seekInput.value = 0;
        seekValue.textContent = "0%";
        statusEl.textContent = "Stopped.";
      });

      rateInput.addEventListener("input", () => {
        const val = parseFloat(rateInput.value).toFixed(1);
        rateValue.textContent = val + "x";
        if (currentUtterance) {
          currentUtterance.rate = parseFloat(val);
        }
      });

      seekInput.addEventListener("change", () => {
        const percent = parseInt(seekInput.value, 10) || 0;
        seekValue.textContent = percent + "%";

        if (!currentText) return;

        const idx = Math.round((percent / 100) * currentText.length);
        currentIndex = idx;

        if (synth.speaking || synth.paused) {
          synth.cancel();
          speakFromCurrentIndex();
        }
      });

      voiceSelect.addEventListener("change", () => {
        if (synth.speaking || synth.paused) {
          synth.cancel();
          speakFromCurrentIndex();
        }
      });

      // Handle clicks on article list
      document.addEventListener("click", (e) => {
        const link = e.target.closest(".article-link");
        if (!link) return;
        e.preventDefault();

        const path = link.getAttribute("data-path");
        if (!path) return;

        // Highlight active link
        document.querySelectorAll(".article-link").forEach(el => {
          el.classList.toggle("active", el === link);
        });

        synth.cancel();
        currentIndex = 0;
        currentText = "";
        articleContentEl.innerHTML = "<p>Loading...</p>";
        loadArticle(path);
      });

      statusEl.textContent = "Select an article to begin.";
    })();
  </script>
</body>
</html>
